From fa7a21ce235b6279e196fa5515c4bcd6742c0f1c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=C3=8Dcaro=20Hoff?= <icarohoff@gmail.com>
Date: Fri, 13 Apr 2018 15:27:04 -0300
Subject: [PATCH] Adjust updater URL to Heroku deployment
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Change-Id: Iee08e15b45dd700f501c4cbe9bf0cf0fe94bb2c6
Signed-off-by: √çcaro Hoff <icarohoff@gmail.com>
---
 res/values/strings.xml                        | 3 +--
 src/org/lineageos/updater/misc/Constants.java | 1 -
 src/org/lineageos/updater/misc/Utils.java     | 4 +---
 3 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/res/values/strings.xml b/res/values/strings.xml
index bb6f50d..1cfe191 100644
--- a/res/values/strings.xml
+++ b/res/values/strings.xml
@@ -30,9 +30,8 @@
         Optional placeholders replaced at runtime:
           {device} - Device name
           {type} - Build type
-          {incr} - Incremental version
     -->
-    <string name="updater_server_url" translatable="false">https://download.lineageos.org/api/v1/{device}/{type}/{incr}</string>
+    <string name="updater_server_url" translatable="false">https://json-lineage.herokuapp.com/api/{device}/{type}</string>
 
     <string name="verification_failed_notification">Verification failed</string>
     <string name="verifying_download_notification">Verifying update</string>
diff --git a/src/org/lineageos/updater/misc/Constants.java b/src/org/lineageos/updater/misc/Constants.java
index 49106d4..672bf73 100644
--- a/src/org/lineageos/updater/misc/Constants.java
+++ b/src/org/lineageos/updater/misc/Constants.java
@@ -33,7 +33,6 @@ public final class Constants {
 
     public static final String PROP_BUILD_DATE = "ro.build.date.utc";
     public static final String PROP_BUILD_VERSION = "ro.lineage.build.version";
-    public static final String PROP_BUILD_VERSION_INCREMENTAL = "ro.build.version.incremental";
     public static final String PROP_DEVICE = "ro.lineage.device";
     public static final String PROP_NEXT_DEVICE = "ro.updater.next_device";
     public static final String PROP_RELEASE_TYPE = "ro.lineage.releasetype";
diff --git a/src/org/lineageos/updater/misc/Utils.java b/src/org/lineageos/updater/misc/Utils.java
index 67895da..7b55730 100644
--- a/src/org/lineageos/updater/misc/Utils.java
+++ b/src/org/lineageos/updater/misc/Utils.java
@@ -144,7 +144,6 @@ public class Utils {
     }
 
     public static String getServerURL(Context context) {
-        String incrementalVersion = SystemProperties.get(Constants.PROP_BUILD_VERSION_INCREMENTAL);
         String device = SystemProperties.get(Constants.PROP_NEXT_DEVICE,
                 SystemProperties.get(Constants.PROP_DEVICE));
         String type = SystemProperties.get(Constants.PROP_RELEASE_TYPE).toLowerCase(Locale.ROOT);
@@ -155,8 +154,7 @@ public class Utils {
         }
 
         return serverUrl.replace("{device}", device)
-                .replace("{type}", type)
-                .replace("{incr}", incrementalVersion);
+                .replace("{type}", type);
     }
 
     public static String getChangelogURL(Context context) {
-- 
2.15.1

